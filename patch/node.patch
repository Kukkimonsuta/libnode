--- a/node.gyp
+++ b/node.gyp
@@ -575,6 +575,8 @@
       ],
 
       'sources': [
+        'src/node_embedding_api.cc',
+        'src/node_embedding_api.h',
         'src/api/async_resource.cc',
         'src/api/callback.cc',
         'src/api/embed_helpers.cc',
--- a/tools/install.py
+++ b/tools/install.py
@@ -174,6 +174,7 @@ def headers(action):
     'config.gypi',
     'src/node.h',
     'src/node_api.h',
+    'src/node_embedding_api.h',
     'src/js_native_api.h',
     'src/js_native_api_types.h',
     'src/node_api_types.h',
--- a/node.gyp
+++ b/node.gyp
@@ -720,6 +720,7 @@
           'libraries': [
             'Dbghelp',
             'Psapi',
+            'winmm',
             'Ws2_32',
           ],
         }],
--- a/node.gyp
+++ b/node.gyp
@@ -255,6 +255,14 @@
             'winmm.lib',
             'Ws2_32.lib',
           ],
+          'conditions': [
+            [ 'node_shared=="true"', { 
+              'dependencies!': [
+                'tools/v8_gypfiles/v8.gyp:v8_snapshot',
+                'tools/v8_gypfiles/v8.gyp:v8_libplatform',
+              ],
+            }],
+          ],
         }],
         ['node_with_ltcg=="true"', {
           'msvs_settings': {
--- a/node.gypi
+++ b/node.gypi
@@ -29,7 +29,7 @@
     [ 'clang==1', {
       'cflags': [ '-Werror=undefined-inline', ]
     }],
-    [ 'node_shared=="false" and "<(_type)"=="executable"', {
+    [ '"<(_type)"=="executable"', {
       'msvs_settings': {
         'VCManifestTool': {
           'EmbedManifest': 'true',